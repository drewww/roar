<!DOCTYPE html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>swarm</title>
	
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		
		// TODO Add handling for the server being missing.
		var socket = io.connect("http://localhost:8080");
		
		socket.on('chat.message', function (data) {
			
			messageHtml = "<div class='message'><div class='from'>" + data.from + "</div><div class='contents'>"+data.message+"</div></div><br>";
			
			$("#chat").html($("#chat").html() + messageHtml);
		});
		
		$(document).ready( function() {
			
			$("#chat").html("");
			$("#message").submit( function(event) {
				console.log("sending message: " + $("#message-text").val());

				socket.emit("chat.message", {message:$("#message-text").val()});
				$("#message-text").val("");
				event.preventDefault();
			});
			
			$("#set_name").click(function() {
				socket.emit("chat.identity", {name:$("#name").val()});
				$("#identity-container").hide();
				$("#chat-container").show();
			});
			
			$("#identity-container").show();
			$("#chat-container").hide();
		});
		
		
		
		
	</script>
	<style type="text/css" media="screen">
		.from {
			font-weight: bold;
		}
	</style>
</head>
<body id="index" onload="">

<div id="identity-container">
<input type="text" name="name" value="your name?" id="name">
<input type="button" name="set_name" value="set name" id="set_name">
</div>

<div id="chat-container">
<div id="chat">
</div>
<form id="message"><input type="text" name="message" value="" id="message-text"></form>
</div>
</body>

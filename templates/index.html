<!DOCTYPE html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>roar</title>
	
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" charset="utf-8">
		
		var socket = io.connect("http://localhost:8080");
		
		socket.on('connect', function(data) {
			console.log("Connected to server.");

			if("roar-username" in localStorage) {
				// This client has logged in before. Present auth to the 
				// server.

				socket.emit("identify", {username:localStorage["roar-username"]});

				// Now we need to start listening for an identify response.
				socket.on('identify', _handleIdentityResponse);
			} else {
				// This client has not logged in before. Present the identify
				// UI and ask them what they want their name to be. Then
				// send that to the server. 
				$("#identity-container").show();
			}
		});
		
		$(document).ready(function() {
			
			// Setup default visibility.
			$("#chat-form").hide();
			$("#identity-message").hide();
			
			// Setup event handlers.
			$("#chat-form").submit(sendChat);
			
			$("#submit-name").click(function() {
				socket.emit("identify", {username:$("#name").val()});
				// Now we wait for the server to confirm it. 
				socket.on("identify", _handleIdentityResponse);
			});
			
			
			// Manage default text.
			$(".default-text").focus(function(srcc)
		    {
		        if ($(this).val() == $(this)[0].title)
		        {
		            $(this).removeClass("default-text-active");
		            $(this).val("");
		        }
		    });

		    $(".default-text").blur(function()
		    {
		        if ($(this).val() == "")
		        {
		            $(this).addClass("default-text-active");
		            $(this).val($(this)[0].title);
		        }
		    });
			
		    $(".default-text").blur();
			
			
		});
		
		
		function sendChat(event) {
			
			chatTextElement = $("#chat-text");
			
			if(chatTextElement.val() == "") {
				if(event!=null) event.preventDefault();
				return;
			}
			
			socket.emit("message", {text:chatTextElement.val()});
			chatTextElement.val("");
			
			if(event!=null) event.preventDefault();
		}
		
		
		function _handleIdentityResponse(data) {
			console.log(" handling identity response");
			console.log(data);
			// this is called with repsonses to requests for a specific user
			// name. The server is either going to say "yes, you got it" or
			// "nope, that one is taken".
			if("state" in data && data["state"] == "OK") {
				// Start up the chat side of things.

				localStorage["roar-username"] = data["username"];

				$("#identity-form").hide();
				$("#chat-form").show();
				$("#chat-input").focus();
				
				$(".button").removeClass("disabled");

			} else if ("state" in data && data["state"] == "TAKEN") {
				// Stay in the same mode.
				$("#identity-message").html("'"+data["username"]+"' is taken");
				$("#identity-message").show();
				$("#identity-form").show();
			}
		}
		
	</script>
	
	<style type="text/css" media="screen">
		
		body {
			background-color: black;
			margin: 0px;
		}
		
		#roar-bar {
			background-color: #928B33;
			
			background: -webkit-gradient(linear, left top, left bottom, from(#928B33), to(#413D1B)); /* for webkit browsers */
			background: -moz-linear-gradient(top,  #928B33,  #413D1B); /* for firefox 3.6+ */
			
			position: fixed;
			bottom: 20%;
			
			width: 100%;
			height: 50px;
			
			color: #FEFAD1;
			
			font-family: Helvetica, sans-serif;
			
			border-top: 1px solid #B3B5B8;
		}
		
		#roar-bar div {
			border-right: 1px solid #B3B5B8;
			height: 100%;
			float: left;
		}
		
		#logo {
			padding-top: 7px;
			
			font-weight: bold;
			font-size: 2em;
			width: 108px;
			text-align: center;
		}
		
		#chat {
			width: 366px;
			padding-top: 11px;
			
			font-size: 1.0em;
		}
		
		#chat-form {
			width: 320px;
		}
		
		#chat-form input {
			width: 100%;
		}
		
		#identity-form, #chat-form {
			margin-left: auto;
			margin-right:auto;
		}
		
		#name {
			
		}
		

		#roar-bar .button {
			width: 70px;
			text-align: center;
			font-size: 1.3em;
			font-variant: small-caps;
			font-weight: bold;
			padding-top: 10px;
			height: 40px;
			
			text-shadow: 1px 1px 0px #111;
			
/* http://stackoverflow.com/questions/826782/css-rule-to-disable-text-selection-highlighting */
			-webkit-user-select: ;
			-khtml-user-select: none;
			-moz-user-select: none;
			-o-user-select: none;
			user-select: none;
		}
		
		#roar-bar .disabled {
			color: #888;
		}
		
		#roar-bar .disabled:active {
			background: inherit !important;
		}
		
		#roar-bar .button:active{
/*			background-color: #413D1B;*/
			
			background: -webkit-gradient(linear, left top, left bottom, from(#413D1B), to(#928B33)); /* for webkit browsers */
			background: -moz-linear-gradient(top,  #413D1B,  #928B33); /* for firefox 3.6+ */
		}
		
		#roar-bar .button:hover {
			cursor:pointer;
		}
		
		#name {
			width: 100px;
			float: left;
			margin-left: 110px;
		}
		
		#submit-name {
			magin-left: 10px;
			margin-bottom: 10px;
		}

		#identity-message {
			background-color: #FEFAD1;
			padding: 3px;
			color: #333;
			font-size: 0.5em;
		}


		/* Using this approach: http://www.dailycoding.com/Posts/default_text_fields_using_simple_jquery_trick.aspx */
	    .default-text { }
	    .default-text-active { color: #a1a1a1; font-style: italic; }
		
		.clear {
			clear: both;
		}
		
	</style>
	
</head>
<body>


<div id="roar-bar">
<div id="logo">ROAR</div>

<div id="chat">
<form id="chat-form">
	<input type="text" name="chat-input" title="say something!" value="" id="chat-input" class="default-text">
</form>

<form id="identity-form">
	<input type="text" name="name" title="your nickname?" value="" id="name"class="default-text">
	<input type="button" name="submit_name" value="login" id="submit-name"><br>
	<div id="identity-message"></div>
</form>

</div>
<div id="chat-button" class="button disabled">
chat
</div>
<div id="shout-button" class="button disabled">
shout
</div>


</div>

</body>
</html>